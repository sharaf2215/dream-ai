<!DOCTYPE html>
<html>
<head>
    <title>Dream AI // Human Interface</title>
    <style>
        /* MATRIX / HUMAN UI THEME */
        body { background-color: #050505; color: #00ff41; font-family: 'Courier New', monospace; padding: 20px; }
        .box { border: 1px solid #333; background: #111; padding: 20px; margin-bottom: 20px; box-shadow: 0 0 15px #002200; }
        h1 { margin-top: 0; border-bottom: 1px solid #00ff41; padding-bottom: 10px; }
        
        /* LOG WINDOW */
        #log-window { 
            height: 400px; 
            overflow-y: scroll; 
            white-space: pre-wrap; 
            color: #ccc; 
            font-size: 15px; 
            background: #000;
            padding: 15px;
            border: 1px solid #333;
            line-height: 1.5;
        }

        /* INPUT FIELD */
        input[type="text"] {
            width: 70%;
            background: #222;
            border: 1px solid #00ff41;
            color: #fff;
            padding: 12px;
            font-family: inherit;
            font-size: 16px;
        }
        button {
            width: 20%;
            background: #00ff41;
            color: #000;
            border: none;
            padding: 12px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #fff; }
        
        /* VOICE TOGGLE */
        .voice-controls { float: right; font-size: 12px; color: #666; cursor: pointer; }
        .voice-active { color: #00ff41; font-weight: bold; }
    </style>
</head>
<body>
    <h1>
        ðŸ§  DREAM AI // HUMAN
        <span id="voice-status" class="voice-controls" onclick="toggleVoice()">[ VOICE: OFF ]</span>
    </h1>
    
    <div class="box">
        <h3>ðŸ’¬ Talk to me</h3>
        <input type="text" id="commandInput" placeholder="Ask me something (e.g., 'Check weather in Paris')...">
        <button onclick="sendCommand()">SEND</button>
    </div>

    <div class="box">
        <h3>ðŸ“¡ Neural Stream</h3>
        <div id="log-window">System Initialized. waiting for input...</div>
    </div>

    <script>
        let lastLog = "";
        let voiceEnabled = false;

        // 1. Toggle Voice On/Off
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voice-status');
            if (voiceEnabled) {
                btn.innerText = "[ VOICE: ONLINE ]";
                btn.classList.add("voice-active");
                speak("Voice systems online.");
            } else {
                btn.innerText = "[ VOICE: OFF ]";
                btn.classList.remove("voice-active");
            }
        }

        // 2. The Speech Function (The Human Voice)
        function speak(text) {
            if (!voiceEnabled) return;
            // Remove emojis and technical junk before speaking
            const cleanText = text.replace(/[\u{1F600}-\u{1F6FF}]/gu, '').replace("RESULT:", ""); 
            const utterance = new SpeechSynthesisUtterance(cleanText);
            
            // Select a "Human" voice (tries to find a decent English voice)
            const voices = window.speechSynthesis.getVoices();
            utterance.voice = voices.find(v => v.lang.includes('en')) || voices[0];
            utterance.rate = 1; 
            utterance.pitch = 1;
            
            window.speechSynthesis.speak(utterance);
        }

        function sendCommand() {
            const input = document.getElementById('commandInput');
            const task = input.value;
            if (!task) return;

            // Visual feedback
            const logWindow = document.getElementById('log-window');
            logWindow.innerText += `\n\n> YOU: ${task}`;
            logWindow.scrollTop = logWindow.scrollHeight;

            fetch('/command', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ task: task })
            })
            .then(response => response.json())
            .then(data => {
                input.value = ""; 
            });
        }

        // Allow "Enter" key
        document.getElementById("commandInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") sendCommand();
        });

        // 3. Monitor Logs for New Responses
        function updateLog() {
            fetch('/brain-log')
                .then(response => response.text())
                .then(data => {
                    const logWindow = document.getElementById('log-window');
                    
                    // Only update if there is new data
                    if (data !== logWindow.innerText) {
                        // Check if the NEW line is a Result (AI Speaking)
                        const lines = data.trim().split('\n');
                        const lastLine = lines[lines.length - 1];
                        
                        if (lastLine.includes("RESULT:") && lastLine !== lastLog) {
                            lastLog = lastLine;
                            // Speak the result!
                            speak(lastLine.split("RESULT:")[1]);
                        }
                        
                        logWindow.innerText = data;
                        logWindow.scrollTop = logWindow.scrollHeight;
                    }
                });
        }
        setInterval(updateLog, 1000);
    </script>
</body>
</html>